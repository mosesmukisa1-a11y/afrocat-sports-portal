<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin - Afrocat Sports Club</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }
    
    .header {
      background: white;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    h1 {
      color: #667eea;
      margin-bottom: 10px;
    }
    
    .admin-info {
      color: #666;
      font-size: 14px;
    }
    
    .pending-section {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    
    .pending-item {
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 15px;
      align-items: start;
    }
    
    .pending-info {
      display: grid;
      gap: 5px;
    }
    
    .pending-info strong {
      color: #333;
    }
    
    .pending-info span {
      color: #666;
      font-size: 14px;
    }
    
    .pending-actions {
      display: flex;
      gap: 10px;
      flex-direction: column;
    }
    
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .btn-approve {
      background: #4caf50;
      color: white;
    }
    
    .btn-approve:hover {
      background: #45a049;
    }
    
    .btn-reject {
      background: #f44336;
      color: white;
    }
    
    .btn-reject:hover {
      background: #da190b;
    }
    
    .btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    
    .modal-content {
      background: white;
      padding: 30px;
      border-radius: 10px;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }
    
    .modal-header {
      margin-bottom: 20px;
    }
    
    .modal-header h2 {
      color: #667eea;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 5px;
      color: #333;
      font-weight: 500;
    }
    
    .form-group textarea {
      width: 100%;
      padding: 10px;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      font-family: inherit;
      resize: vertical;
    }
    
    .modal-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 20px;
    }
    
    .btn-cancel {
      background: #ccc;
      color: #333;
    }
    
    .btn-cancel:hover {
      background: #bbb;
    }
    
    .empty-state {
      text-align: center;
      padding: 40px;
      color: #999;
    }
    
    .photo-preview {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
      margin-top: 10px;
    }
    
    .back-link {
      margin-top: 20px;
    }
    
    .back-link a {
      color: #667eea;
      text-decoration: none;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>Admin Panel</h1>
    <div class="admin-info" id="adminInfo">Loading...</div>
  </div>
  
  <div class="pending-section">
    <h2 style="margin-bottom: 20px; color: #333;">Pending Registrations</h2>
    <div id="pendingList">
      <div class="empty-state">Loading...</div>
    </div>
  </div>
  
  <div id="approveModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Approve Registration</h2>
      </div>
      <div class="form-group">
        <label>Notes (Optional)</label>
        <textarea id="approveNotes" rows="3" placeholder="Add any notes about this approval..."></textarea>
      </div>
      <div class="modal-actions">
        <button class="btn btn-cancel" onclick="closeApproveModal()">Cancel</button>
        <button class="btn btn-approve" onclick="confirmApprove()">Approve</button>
      </div>
    </div>
  </div>
  
  <div id="rejectModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Reject Registration</h2>
      </div>
      <div class="form-group">
        <label>Rejection Reason <span style="color: #c33;">*</span></label>
        <textarea id="rejectReason" rows="4" placeholder="Please provide a reason for rejection..." required></textarea>
      </div>
      <div class="modal-actions">
        <button class="btn btn-cancel" onclick="closeRejectModal()">Cancel</button>
        <button class="btn btn-reject" onclick="confirmReject()">Reject</button>
      </div>
    </div>
  </div>
  
  <div class="back-link">
    <a href="?page=landing">‚Üê Back to Home</a>
  </div>
  
  <script>
    let currentUser = null;
    let pendingUsers = [];
    let currentActionEmail = null;
    
    window.onload = function() {
      const userStr = sessionStorage.getItem('user');
      if (userStr) {
        currentUser = JSON.parse(userStr);
        if (!currentUser.isAdmin) {
          alert('Unauthorized access');
          window.location.href = '?page=landing';
          return;
        }
        document.getElementById('adminInfo').textContent = 'Logged in as: ' + currentUser.email;
      } else {
        alert('Please login first');
        window.location.href = '?page=login';
        return;
      }
      
      loadPendingRegistrations();
    };
    
    function loadPendingRegistrations() {
      google.script.run
        .withSuccessHandler(function(pending) {
          pendingUsers = pending;
          displayPendingList();
        })
        .withFailureHandler(function(error) {
          document.getElementById('pendingList').innerHTML = 
            '<div class="empty-state">Error loading registrations: ' + error.message + '</div>';
        })
        .adminGetPending();
    }
    
    function displayPendingList() {
      const container = document.getElementById('pendingList');
      
      if (pendingUsers.length === 0) {
        container.innerHTML = '<div class="empty-state">No pending registrations</div>';
        return;
      }
      
      container.innerHTML = pendingUsers.map(function(user) {
        return `
          <div class="pending-item">
            <div class="pending-info">
              <strong>${user.name}</strong>
              <span>Email: ${user.email}</span>
              <span>Phone: ${user.phone}</span>
              <span>Role: ${user.role}</span>
              ${user.teamName ? '<span>Team: ' + user.teamName + '</span>' : ''}
              ${user.jerseyNumber ? '<span>Jersey: #' + user.jerseyNumber + '</span>' : ''}
              <span>Member ID: ${user.memberId}</span>
              <span style="font-size: 12px; color: #999;">Registered: ${new Date(user.timestamp).toLocaleString()}</span>
              ${user.profilePhotoURL ? '<img src="' + user.profilePhotoURL + '" class="photo-preview" alt="Photo">' : ''}
            </div>
            <div class="pending-actions">
              <button class="btn btn-approve" onclick="openApproveModal('${user.email}')">Approve</button>
              <button class="btn btn-reject" onclick="openRejectModal('${user.email}')">Reject</button>
            </div>
          </div>
        `;
      }).join('');
    }
    
    function openApproveModal(email) {
      currentActionEmail = email;
      document.getElementById('approveModal').style.display = 'flex';
      document.getElementById('approveNotes').value = '';
    }
    
    function closeApproveModal() {
      document.getElementById('approveModal').style.display = 'none';
      currentActionEmail = null;
    }
    
    function confirmApprove() {
      if (!currentUser || !currentActionEmail) return;
      
      const notes = document.getElementById('approveNotes').value;
      
      google.script.run
        .withSuccessHandler(function() {
          closeApproveModal();
          loadPendingRegistrations();
          alert('User approved successfully!');
        })
        .withFailureHandler(function(error) {
          alert('Error: ' + error.message);
        })
        .adminApprove(currentActionEmail, currentUser.email, notes);
    }
    
    function openRejectModal(email) {
      currentActionEmail = email;
      document.getElementById('rejectModal').style.display = 'flex';
      document.getElementById('rejectReason').value = '';
    }
    
    function closeRejectModal() {
      document.getElementById('rejectModal').style.display = 'none';
      currentActionEmail = null;
    }
    
    function confirmReject() {
      if (!currentUser || !currentActionEmail) return;
      
      const reason = document.getElementById('rejectReason').value;
      if (!reason.trim()) {
        alert('Please provide a rejection reason');
        return;
      }
      
      google.script.run
        .withSuccessHandler(function() {
          closeRejectModal();
          loadPendingRegistrations();
          alert('User rejected successfully!');
        })
        .withFailureHandler(function(error) {
          alert('Error: ' + error.message);
        })
        .adminReject(currentActionEmail, currentUser.email, reason);
    }
    
    window.onclick = function(event) {
      const approveModal = document.getElementById('approveModal');
      const rejectModal = document.getElementById('rejectModal');
      if (event.target === approveModal) {
        closeApproveModal();
      }
      if (event.target === rejectModal) {
        closeRejectModal();
      }
    };
  </script>
</body>
</html>

